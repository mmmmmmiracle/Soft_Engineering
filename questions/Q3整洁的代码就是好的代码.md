## Question3:如何评价代码质量？好的标准是什么？

### 如何评价代码质量？

WTF/min是衡量代码质量的唯一标准，不管代码的格式、注释、写法如何，如果让人看了抓狂就不是好代码。所以我认为**易读性**是衡量代码质量的首要标准。另外好的代码应该还要具有以下特性：

- 正确性：满足特定的任务需求；
- 可靠性：软件系统在一定的时间内无故障运行的能力；
- 性能：能满足极端情况下也能稳定提供服务，比如双十一的阿里服务器的超高并发处理；
- 安全性：漏洞要少；
- 可重用：可以复用代码；
- 可维护；可移植；可测试；方便升级迭代。

------------

### 代码好的标准是什么？

#### 整洁的代码是好的代码的必备属性。

整洁的代码是优雅且高效，直截了当，减少依赖，只做好一件事；是简单直接的；是可读，可维护，单元测试的；

是不重复、单一职责，具有高表达力的。其中表达力道出了好代码的真谛：用简单直接的方式描绘出代码的功能，不多也不少。表达力可以体现为如下七个方面：

##### 1 有内涵的命名

好的命名应该具备：

- **名副其实**：好的变量名告诉你：是什么东西，为什么存在，该怎么使用。如果需要通过注释来解释变量，那么就先得不那么名副其实了。
- **避免误导**：不能挂羊头卖狗肉，不能覆盖惯用缩略语。
- **有意义的区分**：代码是写给机器执行，也是给人阅读的，所以概念一定要有区分度。
- **使用读的出来的单词**：如果名称读不出来，那么讨论的时候就会像个傻鸟。
- **使用方便搜索的命名**：名字长短应与其作用域大小相对应
- **避免思维映射**：比如在代码中写一个temp，那么读者就得每次看到这个单词的时候翻译成其真正的意义。   

##### 2 意图明确的注释　　

- 表明意图：想做什么，为什么这么写，实现的主体功能；
- 警示：对代码关键部分作必要说明，以及他人复用此代码需要注意的地方；
- 阐释输入输出含义，以及关键参数的含义;
- TODO注释。

##### 3 短小精悍的函数

- **函数的单一职责**：一个函数应该只做一件事，这件事应该能通过函数名就能清晰的展示。避免函数功能杂糅在一起；
- **函数的抽象层级**：每个函数一个抽象层次，函数中的语句都要在同一个抽象层级，不同的抽象层级不能放在一起。
- **函数参数**：函数的参数越多，组合出的输入情况就愈多，需要的测试用例也就越多，也就越容易出问题。

##### 4 统一的团队代码格式  　　

- 垂直格式：源文件最顶部应该给出高层次概念和算法，细节应该往下渐次展开;

  - 垂直距离：
  
    - 变量声明尽可能靠近其使用位置。
    - 关系密切的概念，不要放到不同文件中。
    - 概念相关的代码应该放到一起，相关性越强，彼此之间的距离就该越短。
    - 循环中的控制变量(for(int i...))，应该总是在循环语句中声明。
    - 类的属性变量应该**全部**在类的顶部声明，而不是东一个西一个，使人很难找到。
    - 若某个函数调用另一个，就应当把他们放在一起。
  - 垂直顺序:
    - *最上面的代码应该是最抽象的，底部细节应该在下面实现。这样就能像报纸文章一样，最重要的概念在最前面，底部细节最后才会出来*
- 横向格式：一行的上限是120个字符。短代码行，利于理解，所以应该尽力保持代码行短小(在30个字符以内)
- 缩进：违反缩进规则的代码，通常可读性极差。
- 团队规则：代码风格统一，一组开发者应当认同一种格式风格。
##### 5 优雅的使用第三方库    

- 编写学习性测试：
  - 找到最基础的文档，开始阅读文档。每读完几个的api，便开始整合完成所想要的某一个功能，写一个类的一个函数将其封装起来；
  - 完成初步罗列出来的功能便可以开始测试，对函数分别调用，从中弄懂参数和返回值的真正意义，并以此弄清当前函数整合的所有api干了什么；
  - 测试完成后，便应该只用自己封装起来的函数来写自己旳程序。当需要调用新的api，如果这个api属于之前的某个功能，就写进那个功能对应的函数，如果是新的功能，则应该考虑写新的类、新的的函数。

这样可以减少学习成本，减少混乱的调试；另外当他人的代码更新了后，api作用可能会改变，这时候可能会产生兼容性问题，造成程序大范围的出错，而且不易于定位错误，修改代码的代价巨大。而通过编写学习性测试，我们只需将之前编写的函数重新测试一遍，再把出错的函数修改即可。当我们需要的代码还未存在的时候，我们可以编写类似于学习测试的代码，原理仍是通过所需功能来编写函数，这叫做adapter模式。我们通过这种模式，将所需功能写出，因为这样一切我们程序所需调用的函数接在我们的掌控之中，而不是他人的改动的代码。这就类似于一个过渡层，通过它，我们将不同人编写的代码融合。
##### 6 明确清晰的类    

- 类的组织：

  - 类应该从一组变量列表开始。如果有公共静态常量，应该先出现。然后是私有静态变量，以及私有实体变量；
  - 公共函数应跟在变量列表之后，最后再是私有函数.
- 类应该短小：

  - **类名应该精确**。类的名称应该描述其全责，**一个类应该只有一个全责**；
  - 类应该只有少量实体变量。类中的每个方法都应该操作一个或多个这样的变量。
- 修进类的技巧：
  - 当一个类庞杂巨大需要重构的时候，将一个类分隔为几个类，用明确的功能权责来划分；
  - 当有新特性要添加时，可以写一个新类，如果能达到新类只用了原有类的极少数（一个或两个）方法时，就是低耦合度。原有类没有被干扰，新类也相当简洁（只服务于某个新特性）。

##### 7 及时的单元测试    

- 测试应与生产代码应在同一个时间段内编写，先写测试代码再写生产代码。每编玩一个新的功能，就应该写测试来检验功能的是否实现。每次更改生产代码，也应修改测试代码;

- 保持测试代码的整洁。不要以为只是测试就不写整洁的代码，脏测试等同于没测试。测试必须随生产代码的眼镜儿修改，测试代码越脏，就越难修改，修改生产代码后，测试就会开始失败，随着版本的演进，团队维护测试代码的代价也在上升，而随着开发的进行，开发压力的一直增大，最终会导致开发者扔掉整个测试站组。一旦没了测试代码，程序员就失去了确保对代码的改动能如愿工作的能力。这时候整个生产代码开始腐坏。

- 整洁的测试遵循的规则
  - 快速。测试不应该过于缓慢，如果测试过于缓慢，你就会不想频繁的测试，如果你不频繁运行测试，就不能尽早发现问题。代码将腐化；
  - 独立。测试之间应该相互独立，一个功能一个功能的测试，不会相互依赖；
  - 可重复。测试应当可在任何反应中重复通过；
  - 自足验证。测试的结果应该明显，最好是bool值，不应通过查看日志这种低效率的方法来判断测试是否通过。应当由程序来判；
  - 及时。测试应该及时编写。单元测试，应该恰好在使其通过的生产代码之前编写。